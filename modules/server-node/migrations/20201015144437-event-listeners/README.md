# Migration `20201015144437-event-listeners`

This migration has been generated by Rahul Sethuram at 10/15/2020, 4:44:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."event-subscription.event_unique"

ALTER TABLE "public"."event-subscription" ADD COLUMN "publicIdentifier" text   NOT NULL 

CREATE UNIQUE INDEX "event-subscription.publicIdentifier_event_unique" ON "public"."event-subscription"("publicIdentifier", "event")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201013125322-init..20201015144437-event-listeners
--- datamodel.dml
+++ datamodel.dml
@@ -5,9 +5,9 @@
 }
 datasource db {
   provider = ["postgresql", "sqlite"]
-  url = "***"
+  url = "***"
 }
 model Balance {
   participant      String
@@ -132,12 +132,14 @@
   @@map(name: "transfer")
 }
 model EventSubscription {
-  id    String @id @default(uuid())
-  event String @unique
-  url   String
+  id               String @id @default(uuid())
+  event            String
+  publicIdentifier String
+  url              String
+  @@unique([publicIdentifier, event])
   @@map(name: "event-subscription")
 }
 model OnchainTransaction {
@@ -185,9 +187,9 @@
   @@map(name: "configuration")
 }
 model NodeIndex {
-  index Int @id
+  index            Int    @id
   publicIdentifier String @unique
   @@map(name: "node_index")
 }
```


