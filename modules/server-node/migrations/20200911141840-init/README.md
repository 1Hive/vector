# Migration `20200911141840-init`

This migration has been generated by Rahul Sethuram at 9/11/2020, 4:18:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "balance" (
    "participant" TEXT NOT NULL,
    "assetId" TEXT NOT NULL,
    "to" TEXT NOT NULL,
    "amount" TEXT NOT NULL,
    "lockedValue" TEXT NOT NULL,
    "channelAddress" TEXT NOT NULL,

    FOREIGN KEY ("channelAddress") REFERENCES "channel"("channelAddress") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("participant","channelAddress","assetId")
)

CREATE TABLE "channel" (
    "channelAddress" TEXT NOT NULL,
    "publicIdentifierA" TEXT NOT NULL,
    "publicIdentifierB" TEXT NOT NULL,
    "participantA" TEXT NOT NULL,
    "participantB" TEXT NOT NULL,
    "timeout" TEXT NOT NULL,
    "nonce" INTEGER NOT NULL,
    "latestDepositNonce" INTEGER NOT NULL,
    "merkleRoot" TEXT NOT NULL,
    "channelFactoryAddress" TEXT NOT NULL,
    "vectorChannelMastercopyAddress" TEXT NOT NULL,
    "adjudicatorAddress" TEXT NOT NULL,
    "chainId" INTEGER NOT NULL,
    "providerUrl" TEXT NOT NULL,
PRIMARY KEY ("channelAddress")
)

CREATE TABLE "update" (
    "channelAddress" TEXT NOT NULL,
    "fromIdentifier" TEXT NOT NULL,
    "toIdentifier" TEXT NOT NULL,
    "type" TEXT NOT NULL,
    "nonce" INTEGER NOT NULL,
    "amountA" TEXT NOT NULL,
    "amountB" TEXT NOT NULL,
    "toA" TEXT NOT NULL,
    "toB" TEXT NOT NULL,
    "assetId" TEXT NOT NULL,
    "signatureA" TEXT,
    "signatureB" TEXT,
    "transferId" TEXT,
    "transferDefinition" TEXT,
    "transferTimeout" TEXT,
    "transferInitialState" TEXT,
    "transferEncodings" TEXT,
    "merkleProofData" TEXT,
    "transferResolver" TEXT,
    "merkleRoot" TEXT,
    "latestDepositNonce" INTEGER,

    FOREIGN KEY ("channelAddress") REFERENCES "channel"("channelAddress") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("channelAddress","nonce")
)

CREATE UNIQUE INDEX "update_channelAddress_unique" ON "update"("channelAddress")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200911141840-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,84 @@
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["connectOrCreate"]
+  binaryTargets   = ["native"]
+}
+
+datasource db {
+  provider = ["sqlite", "postgresql"]
+  url = "***"
+}
+
+model Balance {
+  @@map(name: "balance")
+  participant    String
+  assetId        String
+  to             String
+  amount         String
+  lockedValue    String
+  Channel        Channel @relation(fields: [channelAddress], references: [channelAddress])
+  channelAddress String
+  @@id([participant, channelAddress, assetId])
+}
+
+model Channel {
+  @@map(name: "channel")
+  channelAddress                 String    @id
+  publicIdentifierA              String
+  publicIdentifierB              String
+  participantA                   String
+  participantB                   String
+  timeout                        String
+  nonce                          Int
+  latestDepositNonce             Int
+  merkleRoot                     String
+  balances                       Balance[]
+  channelFactoryAddress          String
+  vectorChannelMastercopyAddress String
+  adjudicatorAddress             String
+  chainId                        Int
+  providerUrl                    String
+  latestUpdate                   Update?
+}
+
+model Update {
+  @@map(name: "update")
+  // COMMON PARAMS
+  channelAddress String
+  channel        Channel @relation(fields: [channelAddress], references: [channelAddress])
+
+  fromIdentifier String
+  toIdentifier   String
+  type           String
+  nonce          Int
+
+  // balance
+  amountA String
+  amountB String
+  toA     String
+  toB     String
+
+  assetId    String
+  signatureA String?
+  signatureB String?
+
+  // DETAILS
+  // create details
+  transferId           String?
+  transferDefinition   String?
+  transferTimeout      String?
+  transferInitialState String? // JSON string
+  transferEncodings    String?
+  merkleProofData      String?
+
+  // resolve details
+  transferResolver String?
+  merkleRoot       String?
+
+  // deposit details
+  latestDepositNonce Int?
+
+  // setup inferred from channel params
+
+  @@id([channelAddress, nonce])
+}
```


