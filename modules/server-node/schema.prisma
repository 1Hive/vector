generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["connectOrCreate"]
  binaryTargets   = ["native"]
}

datasource db {
  provider = ["sqlite", "postgresql"]
  url      = "file:./connext-store.db"
}

model Balance {
  @@map(name: "balance")
  participant    String
  assetId        String
  to             String
  amount         String
  lockedValue    String
  Channel        Channel @relation(fields: [channelAddress], references: [channelAddress])
  channelAddress String
  @@id([participant, channelAddress, assetId])
}

model Channel {
  @@map(name: "channel")
  channelAddress                 String    @id
  publicIdentifierA              String
  publicIdentifierB              String
  participantA                   String
  participantB                   String
  assetIds                       String
  timeout                        String
  nonce                          Int
  latestDepositNonce             Int
  merkleRoot                     String
  balances                       Balance[]
  channelFactoryAddress          String
  vectorChannelMastercopyAddress String
  adjudicatorAddress             String
  chainId                        Int
  providerUrl                    String
  latestUpdate                   Update?
}

model Update {
  @@map(name: "update")
  // COMMON PARAMS
  channelAddress    String?
  channel           Channel? @relation(fields: [channelAddress], references: [channelAddress])
  channelAddressId  String // required for ID so that relation can be removed

  fromIdentifier String
  toIdentifier   String
  type           String
  nonce          Int

  // balance
  amountA String
  amountB String
  toA     String
  toB     String

  assetId    String
  signatureA String?
  signatureB String?

  // DETAILS
  // create details
  transferId           String?
  transferDefinition   String?
  transferTimeout      String?
  transferInitialState String? // JSON string
  transferEncodings    String?
  merkleProofData      String?

  // resolve details
  transferResolver String?
  merkleRoot       String?

  // deposit details
  latestDepositNonce Int?

  // setup inferred from channel params

  @@id([channelAddressId, nonce])
}
